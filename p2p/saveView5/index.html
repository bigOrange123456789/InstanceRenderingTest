<!DOCTYPE html>
<html lang="en">
<head>
    <title>P2P test 21</title>
</head>
<body>
    <script src="http://youku3d.com/smart3d/lib/adapter.js"></script>
    <script src="http://youku3d.com/smart3d/lib/socket.io.js"></script>
    <script src="http://youku3d.com/smart3d/lib/FileBufferReader.js"></script>
    <script type="module">
        import {RTCMultiConnection} from "./RTCMultiConnection.js"
        var connection = new RTCMultiConnection()

        var tag=document.createElement("div")
        tag.innerHTML="user : "+connection.userid
        document.body.append(tag)

        connection.socketURL = "http://localhost:9001/"
        connection.sdpConstraints.mandatory = {
            OfferToReceiveAudio: false,
            OfferToReceiveVideo: false
        }
        connection.enableFileSharing = true
        connection.session = {data: true}
        connection.onmessage = event=>{
            var tag=document.createElement("div")
            tag.innerHTML=event.userid+" : "+event.data
            document.body.append(tag)
        }
        connection.onopen = event=> {
            //var data={"type":"text","message":"test6","last":true,"isobject":false}
            //data = JSON.stringify(data)
            //connection.peers[event.userid].channels[0].send(data)
        }
        connection.openOrJoin("myRoom2")

        window.connection=connection
        window.send=function(message){
            var data={"type":"text","message":message,"last":true,"isobject":false}
            data = JSON.stringify(data)
            var peer=connection.peers.selectFirst()
            peer.channels[0].send(data)
        }
    </script>
</body>
</html>
