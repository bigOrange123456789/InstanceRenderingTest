<!DOCTYPE html>
<html lang="en">
<head>
    <title>静态模型处理</title>
    <meta charset="utf-8">
</head>
<body>
<script src="js/threeLib/three.js"></script>
<script src="js/threeLib/GLTFLoader.js"></script>
<script src="js/threeLib/GLTFExporter.js"></script>

<script src="js/myLib/Download.js"></script>
<script src="js/GlbHandle.js"></script>
<script src="js/myLib/DuplicateRemoval.js"></script>
<script src="js/myLib/MaterialHandle.js"></script>
<script src="js/myLib/GlbSplit.js"></script>
<script src="js/myLib/InDe.js"></script>
<script src="js/myLib/ResourceManager.js"></script>

<script>

    var path="../../../_DATA_/model/"
    var names=[
        "sphere.glb",
        "mesh2.glb",
        "cube.glb",
        "mesh3.glb",
        "sphere1.glb",
        "mesh0.glb",
        "mesh1.glb",
        "sphere0.glb",
        "mesh.glb"
    ]
    var eigenvectors=[];
    computeEigenvector(0);
    function computeEigenvector(urls_index) {
        new THREE.GLTFLoader().load(path+names[urls_index], (glb) => {
            var scene=new THREE.Scene();
            for(i=glb.scene.children.length-1;i>=0;i--)
                scene.add(glb.scene.children[i]);
            var eigenvector=new GlbHandle().eigenvector({scene:scene},10);
            eigenvectors.push(eigenvector)
            if(urls_index+1<names.length){
                computeEigenvector(urls_index+1);
            }else{
                checkingDuplicate();
            }
        });
    }

    function checkingDuplicate(){
        var result={}
        for(i=0;i<names.length;i++){
            result[names[i]]={
                url:names[i],
                matrix:eigenvectors[i].matrix.elements
            }
        }
        for(var lll=0;lll<names.length;lll++){
            for(var mmm=0;mmm<lll;mmm++){
                var variance=new GlbHandle().variance(eigenvectors[lll].vector,eigenvectors[mmm].vector)
                console.log(variance)
                if(variance<0.01){
                    result[names[lll]].url=names[mmm];
                    break;
                }
            }
        }
        console.log(
            result
        )
    }

</script>

</body>
